{% extends "layouts/base.html" %}

{% block title %} Linear - Manage Playlists {% endblock %} 

<!-- Specific Page CSS goes HERE  -->
{% block stylesheets %}
<style> 
  .playlists .grid-container {
    display: grid;
    grid-template-columns: 0.5fr 0.5fr 2fr 2.75fr 2.75fr 1fr 0.5fr 1fr;
    gap: 10px;
  }

  .uploaded_playlists .grid-container {
    display: grid;
    grid-template-columns: 3fr 4fr 2fr 2fr;
    gap: 10px;
  }

  .child_station_mappings .grid-container {
    display: grid;
    grid-template-columns: 0.5fr 0.95fr 0.95fr 0.95fr 0.95fr 0.95fr 0.95fr 0.95fr 0.95fr 0.95fr 0.95fr 1fr;
    gap: 10px;
  }

  .grid-item {
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 0;
  }

  .enter-playlists .form-check {
      display: flex;
      align-items: center;
      gap: 3.5em; /* Adjust the gap as needed */
  }

  .enter-playlists .form-check-label {
      flex: 1;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
  }

  .enter-playlists .form-check-input {
      flex-shrink: 0;
  }

  input[type="text"] {
      width: 100%;
      box-sizing: border-box;
  }

  .btn {
      width: 100%;
      box-sizing: border-box;
  }

  .file-input-wrapper {
    display: flex;
    align-items: center;
    border: 2px solid #4c2588;
    border-radius: 0.25em;
    padding: 0.5em;
    background: linear-gradient(195deg, #6a4ca8 0%, #6a4eaa 100%);
    margin-left: 1em;
  }

  .file-input-wrapper input[type="file"] {
    display: none;
  }

  .file-input-wrapper label {
    background: linear-gradient(195deg, #4c2588 0%, #4c278a 100%);
    color: white;
    border: none;
    padding: 0.5em 1em;
    border-radius: 0.25em;
    cursor: pointer;
    margin-right: 1em;
    margin-left: 10px;
    box-shadow: 0 3px 3px 0 rgba(76, 37, 136, 0.15), 0 3px 1px -2px rgba(76, 37, 136, 0.2), 0 1px 5px 0 rgba(76, 37, 136, 0.15);
  }

  .file-input-wrapper label:hover {
    background-color: #4c2588;
    border-color: #4c2588;
    box-shadow: 0 14px 26px -12px rgba(76, 37, 136, 0.4), 0 4px 23px 0 rgba(76, 37, 136, 0.15), 0 8px 10px -5px rgba(76, 37, 136, 0.2);
  }

  .file-input-wrapper label:focus {
    color: #fff;
  }

  .file-input-wrapper .file-name {
    flex-grow: 1;
    padding: 0.5em;
    background: #dcc4ff;
    border: 2px solid #4c2588;
    border-radius: 0.25em;
    color: #4c2588;
    width: calc(100% - 1em - 2px);
  }

  .dark-version .file-input-wrapper {
    background: linear-gradient(195deg, #2c1a4a 0%, #2c1b4c 100%);
    border-color: #2c1a4a;
  }

  .dark-version .file-input-wrapper label {
    background: linear-gradient(195deg, #2c1a4a 0%, #2c1b4c 100%);
    color: #ccc;
    box-shadow: 0 3px 3px 0 rgba(44, 26, 74, 0.15), 0 3px 1px -2px rgba(44, 26, 74, 0.2), 0 1px 5px 0 rgba(44, 26, 74, 0.15);
  }

  .dark-version .file-input-wrapper label:hover {
    background-color: #2c1a4a;
    border-color: #2c1a4a;
    box-shadow: 0 14px 26px -12px rgba(44, 26, 74, 0.4), 0 4px 23px 0 rgba(44, 26, 74, 0.15), 0 8px 10px -5px rgba(44, 26, 74, 0.2);
  }

  .dark-version .file-input-wrapper .file-name {
    background: #3c2a6a;
    border-color: #2c1a4a;
    color: #ccc;
  }

  .listbox {
    width: 400px;
    height: 300px;
    overflow-y: scroll;
    border: 1px solid #ccc;
  }
  .container {
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  .buttons {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
  }
  .priority-container {
    display: flex;
    align-items: center;
  }
  .centered-button {
    display: flex;
    justify-content: center;
    align-items: center;
  }
  .box-container {
    border: 1px solid #ccc;
    padding: 10px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    position: relative;
    width: 100%;
    max-width: 482px;
  }
  .form-buttons {
    display: flex;
    justify-content: center;
    margin-top: 5px;
    width: 100%;
    margin-left: -72px;
  }
</style>
{% endblock stylesheets %}

{% block content %}

<div class="container-fluid py-4">
  <div class="row min-vh-80 h-100">
    <div class="col-12">
      <form method="POST" action="/playlists/plm_manage" id="process-form" enctype="multipart/form-data">
        <!-- Prioritize Playlists -->
        <h4 id="priority_playlists_anchor">Prioritize Playlists
          <a href="https://github.com/babsonnexus/stream-link-manager-for-channels/wiki/Usage-%E2%80%90-PLM-%E2%80%90-Manage-Playlists" target="_blank">
            <i class="material-icons opacity-10" style="position: relative; top: 3px;">help_outline</i>
          </a>
        </h4>
        <div class="container">
          <div class="box-container">
            <div class="priority-container">
              <div>
                <select id="priorityList" class="listbox" multiple>
                  <!-- Priority list options will be populated by JavaScript -->
                </select>
              </div>
              <div class="buttons">
                <button type="button" class="btn bg-gradient-primary h-2 w-2 my-2 mb-2 centered-button" onclick="playlists_moveUp()">
                  <i class="material-icons opacity-10">keyboard_arrow_up</i>
                </button>
                <button type="button" class="btn bg-gradient-primary h-2 w-2 my-2 mb-2 centered-button" onclick="playlists_moveDown()">
                  <i class="material-icons opacity-10">keyboard_arrow_down</i>
                </button>
              </div>
            </div>
          </div>
          <div class="form-buttons">
            <button type="submit" name="action" value="priority_playlists_action_save" class="btn bg-gradient-primary w-25 my-2 mb-2" style="margin-right: 2px;" {% if not html_playlists %}disabled{% endif %}>Save</button>
            <button type="submit" name="action" value="priority_playlists_action_cancel" class="btn bg-gradient-primary w-25 my-2 mb-2" style="margin-left: 2px;">Cancel / Reset</button>
          </div>
        </div>
        <input type="hidden" id="priority_playlists" name="priority_playlists">
        <hr>
        <!-- Enter Playlists -->
        <h4 id="playlists_anchor">Enter Playlists
          <a href="https://github.com/babsonnexus/stream-link-manager-for-channels/wiki/Usage-%E2%80%90-PLM-%E2%80%90-Manage-Playlists" target="_blank">
            <i class="material-icons opacity-10" style="position: relative; top: 3px;">help_outline</i>
          </a>
        </h4>
        <p><em>WARNING: It is not recommended to use 'https' as it may result in the link failing to be read.</em></p>
        <div class="playlists container-fluid">
          <div class="grid-container dynamic-bg" style="text-align: center; position: sticky; top: 0; z-index: 10;">
            <div class="grid-item"><h6>Active</h6></div>
            <div class="grid-item"><h6>Check Station Status
              <a href="https://github.com/babsonnexus/stream-link-manager-for-channels/wiki/Usage-%E2%80%90-PLM-%E2%80%90-Processes-%E2%80%90-Check-Station-Status" target="_blank">
                <i class="material-icons opacity-10" style="position: relative; top: 3px;">help_outline</i>
              </a>              
            </h6></div>
            <div class="grid-item"><h6>Name</h6></div>
            <div class="grid-item"><h6>m3u URL</h6></div>
            <div class="grid-item"><h6>[OPTIONAL]<br>EPG XML</h6></div>
            <div class="grid-item"><h6>Stream Format</h6></div>
            <div class="grid-item"><h6># Station(s)</h6></div>
            <div class="grid-item"><h6>Action</h6></div>
          </div>
          {% for item in html_playlists %}
            <input type="hidden" name="playlists_m3u_id_{{ loop.index }}" id="playlists_m3u_id_{{ loop.index }}" value="{{ item.m3u_id }}">
            <div class="grid-container">
              <div class="grid-item">
                <div class="enter-playlists form-check form-switch ps-0 is-filled">
                  <input type="checkbox" id="playlists_m3u_active_{{ loop.index }}" name="playlists_m3u_active_{{ loop.index }}" class="enter-playlists form-check-input" style="margin-left: 3px;"
                    {% if item.m3u_active|lower == 'on' %}checked{% endif %}>
                </div>
              </div>
              <div class="grid-item">
                <div class="enter-playlists form-check form-switch ps-0 is-filled">
                  <input type="checkbox" id="playlists_station_check_{{ loop.index }}" name="playlists_station_check_{{ loop.index }}" class="enter-playlists form-check-input" style="margin-left: 3px;"
                    {% if item.station_check|lower == 'on' %}checked{% endif %}>
                </div>
              </div>
              <div class="grid-item">
                <input type="text" id="playlists_m3u_name_{{ loop.index }}" name="playlists_m3u_name_{{ loop.index }}" value="{{ item.m3u_name }}" title="{{ item.m3u_name }}">
              </div>
              <div class="grid-item">
                <input type="text" id="playlists_m3u_url_{{ loop.index }}" name="playlists_m3u_url_{{ loop.index }}" value="{{ item.m3u_url }}" title="{{ item.m3u_url }}">
              </div>
              <div class="grid-item">
                <input type="text" id="playlists_epg_xml_{{ loop.index }}" name="playlists_epg_xml_{{ loop.index }}" value="{{ item.epg_xml }}" title="{{ item.epg_xml }}">
              </div>
              <div class="grid-item">
                <select class="select2" name="playlists_stream_format_{{ loop.index }}" id="playlists_stream_format_{{ loop.index }}" style="width: 100%; max-width: 100%;">
                  {% for html_stream_format in html_stream_formats %}
                    <option value="{{ html_stream_format }}" {% if html_stream_format == item.stream_format %}selected{% endif %} style="width: auto; min-width: 100%;">{{ html_stream_format }}</option>
                  {% endfor %}
                </select>
              </div>
              <div class="grid-item">
                <input type="text" value="{% for count_item in html_playlists_station_count if count_item.m3u_id == item.m3u_id %}{{ count_item.station_count }}{% endfor %}" readonly style="background-color: #d1cdcde5;" title="{% for count_item in html_playlists_station_count if count_item.m3u_id == item.m3u_id %}{{ count_item.station_count }}{% endfor %}">
              </div>
              <div class="grid-item">
                <button type="submit" name="action" value="playlists_action_delete_{{ loop.index }}" class="btn bg-gradient-primary my-2 mb-2">Delete</button>
              </div>
            </div>
            <input type="hidden" name="playlists_m3u_priority_{{ loop.index }}" id="playlists_m3u_priority_{{ loop.index }}" value="{{ item.m3u_priority }}">
          {% endfor %}
          <div class="grid-container">
            <div class="grid-item">
              <div class="enter-playlists form-check form-switch ps-0 is-filled">
                <input type="checkbox" id="playlists_m3u_active_new" name="playlists_m3u_active_new" class="enter-playlists form-check-input" style="margin-left: 3px;" checked>
              </div>
            </div>
            <div class="grid-item">
              <div class="enter-playlists form-check form-switch ps-0 is-filled">
                <input type="checkbox" id="playlists_station_check_new" name="playlists_station_check_new" class="enter-playlists form-check-input" style="margin-left: 3px;">
              </div>
            </div>
            <div class="grid-item">
              <input type="text" id="playlists_m3u_name_new" name="playlists_m3u_name_new" placeholder="i.e., Pluto, Plex (Gracenote)">
            </div>
            <div class="grid-item">
              <input type="text" id="playlists_m3u_url_new" name="playlists_m3u_url_new" placeholder="i.e., http://localhost:7972/pluto/local/playlist.m3u">
            </div>
            <div class="grid-item">
              <input type="text" id="playlists_epg_xml_new" name="playlists_epg_xml_new" placeholder="i.e., http://localhost:7972/pluto/epg/local/epg-local.xml">
            </div>
            <div class="grid-item">
              <select class="select2" name="playlists_stream_format_new" id="playlists_stream_format_new" style="width: 100%; max-width: 100%;">
                {% for html_stream_format in html_stream_formats %}
                  <option value="{{ html_stream_format }}" {% if loop.first %}selected{% endif %} style="width: auto; min-width: 100%;">{{ html_stream_format }}</option>
                {% endfor %}
              </select>
            </div>
            <div class="grid-item">
              <hr style="border: 3px solid; width: 100%;">
            </div>
            <div class="grid-item">
              <button type="submit" name="action" value="playlists_action_new" class="btn bg-gradient-primary my-2 mb-2" disabled>Add</button>
            </div>
          </div>
          <div id="floating-buttons" style="position: sticky; bottom: 0; padding: 10px;">
            <button type="submit" name="action" value="playlists_action_save" class="btn bg-gradient-primary w-25 my-2 mb-2" disabled>Save</button>
            <button type="submit" name="action" value="playlists_action_cancel" class="btn bg-gradient-primary w-25 my-2 mb-2">Cancel / Reset</button>
          </div>
        </div>
        <hr>
        <!-- Internal Playlists -->
        <h4 id="internal_playlists_anchor">Internal Playlists
          <a href="https://github.com/babsonnexus/stream-link-manager-for-channels/wiki/Usage-%E2%80%90-PLM-%E2%80%90-Internal-Stations" target="_blank">
            <i class="material-icons opacity-10" style="position: relative; top: 3px;">help_outline</i>
          </a>
        </h4>
        <!-- Spacer row -->
        <div class="row">
          <div class="col-12 my-2"></div>
        </div>
        <div class="form-check form-switch ps-0 is-filled">
          <!-- Streaming Stations -->
          <div class="settings-box" style="width: 98%; display: inline-block; border: 1px solid #ccc; padding: 10px; box-sizing: border-box; vertical-align: top; margin-bottom: 5px;">
            <input type="checkbox" class="form-check-input ms-auto" id="plm_streaming_stations" name="plm_streaming_stations" {% if html_plm_streaming_stations %}checked{% endif %}>
            <label class="form-check-label text-body ms-3 text-truncate w-80 mb-0" for="plm_streaming_stations"><b>Streaming Stations</b>
              <a href="https://github.com/babsonnexus/stream-link-manager-for-channels/wiki/Usage-%E2%80%90-PLM-%E2%80%90-Streaming-Stations-%E2%80%90-Managed-Stations" target="_blank">
                <i class="material-icons opacity-10" style="position: relative; top: 3px;">help_outline</i>
              </a>
            </label>
            <p><em>Create your own stations from places like YouTube, Twitch, news websites, and other similar sources.</em></p>
          </div>
          <!-- PBS Stations -->
          <div class="settings-box" style="width: 98%; display: inline-block; border: 1px solid #ccc; padding: 10px; box-sizing: border-box; vertical-align: top; margin-bottom: 5px;">
            <input type="checkbox" class="form-check-input ms-auto" id="plm_internal_pbs_stations" name="plm_internal_pbs_stations" {% if html_plm_internal_pbs_stations == "On" %}checked{% endif %}>
            <label class="form-check-label text-body ms-3 text-truncate w-80 mb-0" for="plm_internal_pbs_stations"><b>PBS Stations</b>
              <a href="https://github.com/babsonnexus/stream-link-manager-for-channels/wiki/Usage-%E2%80%90-PLM-%E2%80%90-PBS-Stations" target="_blank">
                <i class="material-icons opacity-10" style="position: relative; top: 3px;">help_outline</i>
              </a>
            </label>
            <div style="display: flex; align-items: center; gap: 10px; margin-top: 0px; margin-bottom: 10px;">
              <label class="form-check-label text-body mb-0" for="plm_internal_pbs_url_base"><b>VLC Bridge PBS Base URL:</b></label>
              <input type="text" id="plm_internal_pbs_url_base" name="plm_internal_pbs_url_base" value="{{ html_plm_internal_pbs_url_base }}" style="flex: 1;" title="{{ html_plm_internal_pbs_url_base }}" placeholder="i.e., http://localhost:7777">
            </div>
            <p><em>Gain access to local PBS stations that are available in your market. This playlist is designed to make sure you can receive your legally available stations even when internet geolocation fails or is incorrect. A prior installation of the 'vlc-bridge-pbs' tool is required.</em></p>
          </div>
        </div>
        <div style="display: flex; margin-top: 10px; width: 98%;">
          <button type="submit" name="action" value="internal_playlists_save_settings" class="btn bg-gradient-primary w-20 my-2 mb-2" style="margin-right: 5px;">Save</button>
          <button type="submit" name="action" value="internal_playlists_cancel" class="btn bg-gradient-primary w-20 my-2 mb-2" style="margin-left: 5px;">Cancel</button>
        </div>
        <hr>
        <!-- Uploaded Playlists -->
        <h4 id="uploaded_playlists_anchor">Uploaded and Generated Playlists, Guides, and Related Files
          <a href="https://github.com/babsonnexus/stream-link-manager-for-channels/wiki/Usage-%E2%80%90-PLM-%E2%80%90-Manage-Playlists" target="_blank">
            <i class="material-icons opacity-10" style="position: relative; top: 3px;">help_outline</i>
          </a>
        </h4>
        {% if html_uploaded_playlist_files %}
          <div class="uploaded_playlists container-fluid">
            <div class="grid-container" style="text-align: center;">
              <div class="grid-item"><h6>File Type</h6></div>
              <div class="grid-item"><h6>File Link</h6></div>
              <div class="grid-item"><h6>Action 1</h6></div>
              <div class="grid-item"><h6>Action 2</h6></div>
            </div>
          {% endif %} 
          {% for html_uploaded_playlist_file in html_uploaded_playlist_files %}
            <div class="grid-container" style="text-align: center;">
              <div class="grid-item">
                <input type="text" id="uploaded_playlists_type_{{ loop.index }}" name="uploaded_playlists_type_{{ loop.index }}" value="{{ html_uploaded_playlist_file.file_type }}" readonly style="background-color: #d1cdcde5;" title="{{ html_uploaded_playlist_file.file_type }}">
              </div>
              <div class="grid-item">
                <input type="text" id="uploaded_playlists_file_{{ loop.index }}" name="uploaded_playlists_file_{{ loop.index }}" value="{{ request.url_root }}playlists/uploads/{{ html_uploaded_playlist_file.file_link }}" readonly style="background-color: #d1cdcde5;" title="{{ request.url_root }}playlists/uploads/{{ html_uploaded_playlist_file.file_link }}">
              </div>
              <div class="grid-item">
                {% if 'Guide Data' in html_uploaded_playlist_file.file_type %}
                  <button type="submit" name="action" value="generated_playlists_action_add_to_plm_{{ loop.index }}" class="btn bg-gradient-primary my-2 mb-2" disabled>Guide Data</button>
                {% else %}
                  <button type="submit" name="action" value="generated_playlists_action_add_to_plm_{{ loop.index }}" class="btn bg-gradient-primary my-2 mb-2">Add to Playlists</button>
                {% endif %}
              </div>
              <div class="grid-item">
                {% set substrings = ['plmss', 'internal/'] %}
                {% if html_uploaded_playlist_file.file_link is string and substrings | select('in', html_uploaded_playlist_file.file_link) | list | length > 0 %}
                  {% if html_slm_channels_dvr_integration %}
                    <button type="submit" name="action" value="generated_playlists_action_add_to_channels_{{ loop.index }}" class="btn bg-gradient-primary my-2 mb-2">Add to Channels DVR</button>
                  {% else %}
                    <button type="submit" name="action" value="generated_playlists_action_add_to_placeholder_{{ loop.index }}" class="btn bg-gradient-primary my-2 mb-2" disabled>Generated Playlist</button>
                  {% endif %}
                {% else %}
                  <button type="submit" name="action" value="uploaded_playlists_action_delete_{{ loop.index }}" class="btn bg-gradient-primary my-2 mb-2">Delete</button>
                {% endif %}
              </div>
            </div>
          {% endfor %}
        </div>
        <div class="file-input-wrapper w-90 h-15 my-2 mb-2">
          <button type="submit" name="action" value="uploaded_playlists_action_new" class="btn bg-gradient-primary w-20 h-15 my-2 mb-2" style="margin-right: 10px;">Upload / Replace</button>
          <input type="file" id="uploaded_playlists_action_new_file" name="uploaded_playlists_action_new_file" class="form-control" onchange="document.getElementById('uploaded_playlists_action_new_file_file').textContent = this.files[0].name">
          <div id="uploaded_playlists_action_new_file_file" class="file-name">No file chosen</div>
          <label for="uploaded_playlists_action_new_file">Browse...</label>
        </div>
        <p><div id="html_uploaded_playlists_message">{{ html_uploaded_playlists_message }}</div></p>
        <hr>
        <!-- Prioritize Child Station Mappings -->
        <h4 id="priority_child_station_mappings_anchor">Prioritize Child Station Mappings
          <a href="https://github.com/babsonnexus/stream-link-manager-for-channels/wiki/Usage-%E2%80%90-PLM-%E2%80%90-Manage-Playlists-%E2%80%90-Child-Station-Mappings" target="_blank">
            <i class="material-icons opacity-10" style="position: relative; top: 3px;">help_outline</i>
          </a>
        </h4>
        <div class="container">
          <div class="box-container">
            <div class="priority-container">
              <div>
                <select id="priorityChildStationMappingsList" class="listbox" multiple>
                  <!-- Priority list options will be populated by JavaScript -->
                </select>
              </div>
              <div class="buttons">
                <button type="button" class="btn bg-gradient-primary h-2 w-2 my-2 mb-2 centered-button" onclick="child_station_mappings_moveUp()">
                  <i class="material-icons opacity-10">keyboard_arrow_up</i>
                </button>
                <button type="button" class="btn bg-gradient-primary h-2 w-2 my-2 mb-2 centered-button" onclick="child_station_mappings_moveDown()">
                  <i class="material-icons opacity-10">keyboard_arrow_down</i>
                </button>
              </div>
            </div>
          </div>
          <div class="form-buttons">
            <button type="submit" name="action" value="priority_child_station_mapping_save" class="btn bg-gradient-primary w-25 my-2 mb-2" style="margin-right: 2px;" {% if not html_station_mappings %}disabled{% endif %}>Save</button>
            <button type="submit" name="action" value="priority_child_station_mapping_cancel" class="btn bg-gradient-primary w-25 my-2 mb-2" style="margin-left: 2px;">Cancel / Reset</button>
          </div>
        </div>
        <input type="hidden" id="priority_child_station_mappings" name="priority_child_station_mappings">
        <p></p>
        <hr>
        <!-- Child Station Mappings -->
        <h4 id="child_station_mappings_anchor">Child Station Mappings
          <a href="https://github.com/babsonnexus/stream-link-manager-for-channels/wiki/Usage-%E2%80%90-PLM-%E2%80%90-Manage-Playlists-%E2%80%90-Child-Station-Mappings" target="_blank">
            <i class="material-icons opacity-10" style="position: relative; top: 3px;">help_outline</i>
          </a>
        </h4>
        <div class="child_station_mappings container-fluid">
          <div class="grid-container dynamic-bg" style="text-align: center; position: sticky; top: 0; z-index: 10;">
            <div class="grid-item"><h6>Active</h6></div>
            <div class="grid-item"><h6>Name</h6></div>
            <div class="grid-item"><h6>IF 'Source Playlist' is</div>
            <div class="grid-item"><h6>AND field is</h6></div>
            <div class="grid-item"><h6>THEN check IF field</h6></div>
            <div class="grid-item"><h6>THIS value</h6></div>
            <div class="grid-item"><h6>IF TRUE, THEN change field</h6></div>
            <div class="grid-item"><h6>BY</h6></div>
            <div class="grid-item"><h6>THIS value</h6></div>
            <div class="grid-item"><h6>AND set 'Parent' to</h6></div>
            <div class="grid-item"><h6>AND set 'Stream Format Override' to</h6></div>
            <div class="grid-item"><h6>Action</h6></div>
          </div>
          {% for item in html_station_mappings %}
            <input type="hidden" name="child_station_mapping_station_mapping_id_{{ loop.index }}" id="child_station_mapping_station_mapping_id_{{ loop.index }}" value="{{ item.station_mapping_id }}">
            <input type="hidden" name="child_station_mapping_station_mapping_priority_{{ loop.index }}" id="child_station_mapping_station_mapping_priority_{{ loop.index }}" value="{{ item.station_mapping_priority }}">
            <div class="grid-container">
              <div class="grid-item">
                <div class="enter-playlists form-check form-switch ps-0 is-filled">
                  <input type="checkbox" id="child_station_mapping_station_mapping_active_{{ loop.index }}" name="child_station_mapping_station_mapping_active_{{ loop.index }}" class="enter-playlists form-check-input" style="margin-left: 3px;"
                    {% if item.station_mapping_active|lower == 'on' %}checked{% endif %}>
                </div>
              </div>
              <div class="grid-item">
                <input type="text" id="child_station_mapping_station_mapping_name_{{ loop.index }}" name="child_station_mapping_station_mapping_name_{{ loop.index }}" value="{{ item.station_mapping_name }}" title="{{ item.station_mapping_name }}">
              </div>
              <div class="grid-item">
                <select class="select2" name="child_station_mapping_source_m3u_id_{{ loop.index }}" id="child_station_mapping_source_m3u_id_{{ loop.index }}" style="width: 100%; max-width: 100%;">
                  {% for html_station_mapping_source_m3u_id in html_station_mapping_source_m3u_ids %}
                    <option value="{{ html_station_mapping_source_m3u_id.m3u_id }}" {% if html_station_mapping_source_m3u_id.m3u_id == item.source_m3u_id %}selected{% endif %} style="width: auto; min-width: 100%;">{{ html_station_mapping_source_m3u_id.m3u_name }}</option>
                  {% endfor %}
                </select>
              </div>
              <div class="grid-item">
                <select class="select2" name="child_station_mapping_source_field_selected_{{ loop.index }}" id="child_station_mapping_source_field_selected_{{ loop.index }}" style="width: 100%; max-width: 100%;">
                  {% for html_station_mapping_source_field in html_station_mapping_source_fields %}
                    <option value="{{ html_station_mapping_source_field.field_id }}" {% if html_station_mapping_source_field.field_id == item.source_field %}selected{% endif %} style="width: auto; min-width: 100%;">{{ html_station_mapping_source_field.field_name }}</option>
                  {% endfor %}
                </select>
              </div>
              <div class="grid-item">
                <select class="select2" name="child_station_mapping_source_field_compare_id_{{ loop.index }}" id="child_station_mapping_source_field_compare_id_{{ loop.index }}" style="width: 100%; max-width: 100%;">
                  {% for html_compare_option in html_compare_options %}
                    <option value="{{ html_compare_option.compare_id }}" {% if html_compare_option.compare_id == item.source_field_compare_id %}selected{% endif %} style="width: auto; min-width: 100%;">{{ html_compare_option.compare_name }}</option>
                  {% endfor %}
                </select>
              </div>
              <div class="grid-item">
                <input type="text" id="child_station_mapping_source_field_string_{{ loop.index }}" name="child_station_mapping_source_field_string_{{ loop.index }}" value="{{ item.source_field_string }}" title="{{ item.source_field_string }}">
              </div>
              <div class="grid-item">
                <select class="select2" name="child_station_mapping_target_field_selected_{{ loop.index }}" id="child_station_mapping_target_field_selected_{{ loop.index }}" style="width: 100%; max-width: 100%;">
                  {% for html_station_mapping_target_field in html_station_mapping_target_fields %}
                    <option value="{{ html_station_mapping_target_field.field_id }}" {% if html_station_mapping_target_field.field_id == item.target_field %}selected{% endif %} style="width: auto; min-width: 100%;">{{ html_station_mapping_target_field.field_name }}</option>
                  {% endfor %}
                </select>
              </div>
              <div class="grid-item">
                <select class="select2" name="child_station_mapping_target_field_compare_replace_id_{{ loop.index }}" id="child_station_mapping_target_field_compare_replace_id_{{ loop.index }}" style="width: 100%; max-width: 100%;">
                  {% for html_compare_replace_option in html_compare_replace_options %}
                    <option value="{{ html_compare_replace_option.compare_replace_id }}" {% if html_compare_replace_option.compare_replace_id == item.target_field_compare_replace_id %}selected{% endif %} style="width: auto; min-width: 100%;">{{ html_compare_replace_option.compare_replace_name }}</option>
                  {% endfor %}
                </select>
              </div>
              <div class="grid-item">
                <input type="text" id="child_station_mapping_target_field_string_{{ loop.index }}" name="child_station_mapping_target_field_string_{{ loop.index }}" value="{{ item.target_field_string }}" title="{{ item.target_field_string }}">
              </div>
              <div class="grid-item">
                <select class="select2" name="child_station_mapping_target_parent_channel_id_{{ loop.index }}" id="child_station_mapping_target_parent_channel_id_{{ loop.index }}" style="width: 100%; max-width: 100%;">
                  {% for html_station_mapping_target_parent_channel_id in html_station_mapping_target_parent_channel_ids %}
                    <option value="{{ html_station_mapping_target_parent_channel_id.parent_channel_id }}" {% if html_station_mapping_target_parent_channel_id.parent_channel_id == item.target_parent_channel_id %}selected{% endif %} style="width: auto; min-width: 100%;">{{ html_station_mapping_target_parent_channel_id.parent_title }}</option>
                  {% endfor %}
                </select>
              </div>
              <div class="grid-item">
                <select class="select2" name="child_station_mapping_target_stream_format_override_{{ loop.index }}" id="child_station_mapping_target_stream_format_override_{{ loop.index }}" style="width: 100%; max-width: 100%;">
                  {% for html_stream_format_override in html_stream_formats_overrides %}
                    <option value="{{ html_stream_format_override }}" {% if html_stream_format_override == item.target_stream_format_override %}selected{% endif %} style="width: auto; min-width: 100%;">{{ html_stream_format_override }}</option>
                  {% endfor %}
                </select>
              </div>
              <div class="grid-item">
                <button type="submit" name="action" value="child_station_mapping_delete_{{ loop.index }}" class="btn bg-gradient-primary my-2 mb-2">Delete</button>
              </div>
            </div>
            <input type="hidden" name="playlists_m3u_priority_{{ loop.index }}" id="playlists_m3u_priority_{{ loop.index }}" value="{{ item.m3u_priority }}">
          {% endfor %}
          <div class="grid-container">
            <div class="grid-item">
              <div class="enter-playlists form-check form-switch ps-0 is-filled">
                <input type="checkbox" id="child_station_mapping_station_mapping_active_new" name="child_station_mapping_station_mapping_active_new" class="enter-playlists form-check-input" style="margin-left: 3px;"
                  checked>
              </div>
            </div>
            <div class="grid-item">
              <input type="text" id="child_station_mapping_station_mapping_name_new" name="child_station_mapping_station_mapping_name_new" placeholder="i.e., 'Baseball Rule'" title="i.e., 'Baseball Rule'">
            </div>             
            <div class="grid-item">
              <select class="select2" name="child_station_mapping_source_m3u_id_new" id="child_station_mapping_source_m3u_id_new" style="width: 100%; max-width: 100%;">
                {% for html_station_mapping_source_m3u_id in html_station_mapping_source_m3u_ids %}
                  <option value="{{ html_station_mapping_source_m3u_id.m3u_id }}" {% if loop.first %}selected{% endif %} style="width: auto; min-width: 100%;">{{ html_station_mapping_source_m3u_id.m3u_name }}</option>
                {% endfor %}
              </select>
            </div>
            <div class="grid-item">
              <select class="select2" name="child_station_mapping_source_field_selected_new" id="child_station_mapping_source_field_selected_new" style="width: 100%; max-width: 100%;">
                {% for html_station_mapping_source_field in html_station_mapping_source_fields %}
                  <option value="{{ html_station_mapping_source_field.field_id }}" {% if loop.first %}selected{% endif %} style="width: auto; min-width: 100%;">{{ html_station_mapping_source_field.field_name }}</option>
                {% endfor %}
              </select>
            </div>
            <div class="grid-item">
              <select class="select2" name="child_station_mapping_source_field_compare_id_new" id="child_station_mapping_source_field_compare_id_new" style="width: 100%; max-width: 100%;">
                {% for html_compare_option in html_compare_options %}
                  <option value="{{ html_compare_option.compare_id }}" {% if loop.first %}selected{% endif %} style="width: auto; min-width: 100%;">{{ html_compare_option.compare_name }}</option>
                {% endfor %}
              </select>
            </div>
            <div class="grid-item">
              <input type="text" id="child_station_mapping_source_field_string_new" name="child_station_mapping_source_field_string_new" placeholder="i.e., 'Baseball'" title="i.e., 'Baseball'">
            </div>
            <div class="grid-item">
              <select class="select2" name="child_station_mapping_target_field_selected_new" id="child_station_mapping_target_field_selected_new" style="width: 100%; max-width: 100%;">
                {% for html_station_mapping_target_field in html_station_mapping_target_fields %}
                  <option value="{{ html_station_mapping_target_field.field_id }}" {% if loop.first %}selected{% endif %} style="width: auto; min-width: 100%;">{{ html_station_mapping_target_field.field_name }}</option>
                {% endfor %}
              </select>
            </div>
            <div class="grid-item">
              <select class="select2" name="child_station_mapping_target_field_compare_replace_id_new" id="child_station_mapping_target_field_compare_replace_id_new" style="width: 100%; max-width: 100%;">
                {% for html_compare_replace_option in html_compare_replace_options %}
                  <option value="{{ html_compare_replace_option.compare_replace_id }}" {% if loop.first %}selected{% endif %} style="width: auto; min-width: 100%;">{{ html_compare_replace_option.compare_replace_name }}</option>
                {% endfor %}
              </select>
            </div>
            <div class="grid-item">
              <input type="text" id="child_station_mapping_target_field_string_new" name="child_station_mapping_target_field_string_new" placeholder="i.e., 'http://www.somewebsite.com/baseball.gif'" title="i.e., 'http://www.somewebsite.com/baseball.gif'">
            </div>
            <div class="grid-item">
              <select class="select2" name="child_station_mapping_target_parent_channel_id_new" id="child_station_mapping_target_parent_channel_id_new" style="width: 100%; max-width: 100%;">
                {% for html_station_mapping_target_parent_channel_id in html_station_mapping_target_parent_channel_ids %}
                  <option value="{{ html_station_mapping_target_parent_channel_id.parent_channel_id }}" {% if loop.first %}selected{% endif %} style="width: auto; min-width: 100%;">{{ html_station_mapping_target_parent_channel_id.parent_title }}</option>
                {% endfor %}
              </select>
            </div>
            <div class="grid-item">
              <select class="select2" name="child_station_mapping_target_stream_format_override_new" id="child_station_mapping_target_stream_format_override_new" style="width: 100%; max-width: 100%;">
                {% for html_stream_format_override in html_stream_formats_overrides %}
                  <option value="{{ html_stream_format_override }}" {% if loop.first %}selected{% endif %} style="width: auto; min-width: 100%;">{{ html_stream_format_override }}</option>
                {% endfor %}
              </select>
            </div>
            <div class="grid-item">
              <button type="submit" name="action" value="child_station_mapping_new" class="btn bg-gradient-primary my-2 mb-2" disabled>Add</button>
            </div>
          </div>
          <div id="floating-buttons" style="position: sticky; bottom: 0; padding: 10px;">
            <button type="submit" name="action" value="child_station_mapping_save" class="btn bg-gradient-primary w-25 my-2 mb-2" disabled>Save</button>
            <button type="submit" name="action" value="child_station_mapping_cancel" class="btn bg-gradient-primary w-25 my-2 mb-2">Cancel / Reset</button>
          </div>
        </div>
      </form>
    </div>
  </div>
  <div class="modal fade" id="loadingModal" tabindex="-1" aria-labelledby="loadingModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="loadingModalLabel">Processing</h5>
        </div>
        <div class="modal-body">
          Please wait while the process completes...
        </div>
      </div>
    </div>
  </div>

    <!-- {% include 'includes/footer.html' %} -->

</div>

{% endblock content %}

<!-- Specific Page JS goes HERE  -->
{% block javascripts %}
<!-- Anchor ID -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
      const anchorId = "{{ html_playlists_anchor_id }}";
      if (anchorId) {
          window.location.hash = anchorId;
      }
  });
</script>
<!-- Processing Box -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('process-form').addEventListener('submit', function(event) {
      console.log("Form submitted"); // Debugging

      // Wait for a short delay to ensure the form submission is not blocked
      setTimeout(() => {
        // Ensure the modal element exists
        const modalElement = document.getElementById('loadingModal');
        if (!modalElement) {
          console.error('Modal element not found!');
          return;
        }

        // Show the modal
        const loadingModal = new bootstrap.Modal(modalElement, {
          backdrop: 'static',
          keyboard: false
        });
        console.log("Showing modal"); // Debugging
        loadingModal.show();

        // Disable all navigation links
        document.querySelectorAll('a').forEach(element => {
          element.setAttribute('disabled', 'true');
          element.addEventListener('click', function(event) {
            event.preventDefault();
          });
        });
      }, 500); // Adjust the delay as needed
    });
  });
</script>
<!-- Playlists Buttons -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const addButton = document.querySelector('button[name="action"][value="playlists_action_new"]');
    const saveButton = document.querySelector('button[name="action"][value="playlists_action_save"]');

    const checkNewInputs = () => {
      const newName = document.getElementById('playlists_m3u_name_new').value.trim();
      const newUrl = document.getElementById('playlists_m3u_url_new').value.trim();
      addButton.disabled = !newName || !newUrl;
    };

    const checkExistingInputs = () => {
      let allValid = true;
      let hasExistingRecords = false;
      document.querySelectorAll('input[id^="playlists_m3u_name_"]').forEach(input => {
        if (input.id.includes('_new')) return;
        hasExistingRecords = true;
        if (!input.value.trim()) allValid = false;
      });
      document.querySelectorAll('input[id^="playlists_m3u_url_"]').forEach(input => {
        if (input.id.includes('_new')) return;
        hasExistingRecords = true;
        if (!input.value.trim()) allValid = false;
      });
      saveButton.disabled = !allValid || !hasExistingRecords;
    };

    document.getElementById('playlists_m3u_name_new').addEventListener('input', checkNewInputs);
    document.getElementById('playlists_m3u_url_new').addEventListener('input', checkNewInputs);

    document.querySelectorAll('input[id^="playlists_m3u_name_"], input[id^="playlists_m3u_url_"]').forEach(input => {
      if (!input.id.includes('_new')) {
        input.addEventListener('input', checkExistingInputs);
      }
    });

    checkNewInputs();
    checkExistingInputs(); // Ensure initial state is checked
  });
</script>
<!-- Playlist Priority -->
<script>
  const priorityPlaylists = {{ html_playlists | tojson }};
  const priorityList = document.getElementById('priorityList');
  const priorityPlaylistsInput = document.getElementById('priority_playlists');

  function populateLists() {
    priorityList.innerHTML = '';
    const activePlaylists = priorityPlaylists.filter(playlist => playlist.m3u_active === 'On');
    activePlaylists.sort((a, b) => (a.m3u_priority || 0) - (b.m3u_priority || 0));
    activePlaylists.forEach(playlist => {
        const option = document.createElement('option');
        option.value = playlist.m3u_id;
        option.text = playlist.m3u_name;
        priorityList.appendChild(option);
    });
  }

  function playlists_moveUp() {
    const selectedOptions = Array.from(priorityList.selectedOptions);
    selectedOptions.forEach(option => {
      const previousOption = option.previousElementSibling;
      if (previousOption) {
        priorityList.insertBefore(option, previousOption);
        playlists_updatePlaylistPriority();
      }
    });
  }

  function playlists_moveDown() {
    const selectedOptions = Array.from(priorityList.selectedOptions);
    selectedOptions.reverse().forEach(option => {
      const nextOption = option.nextElementSibling;
      if (nextOption) {
        priorityList.insertBefore(nextOption, option);
        playlists_updatePlaylistPriority();
      }
    });
  }

  function playlists_updatePlaylistPriority() {
    const allOptions = Array.from(priorityList.options);
    const activePlaylists = priorityPlaylists.filter(playlist => playlist.m3u_active === 'On');
    
    // Ensure unique priorities for active playlists first
    allOptions.forEach((option, index) => {
      const playlist = activePlaylists.find(s => s.m3u_id === option.value);
      if (playlist) {
        playlist.m3u_priority = index + 1;
      }
    });

    // Reorder priorities to ensure uniqueness across all playlists
    priorityPlaylists.sort((a, b) => (a.m3u_priority || 0) - (b.m3u_priority || 0));
    priorityPlaylists.forEach((playlist, index) => {
      playlist.m3u_priority = index + 1;
    });

    playlists_updateHiddenInput();
  }

  function playlists_updateHiddenInput() {
    priorityPlaylistsInput.value = JSON.stringify(priorityPlaylists.map(playlist => ({
      m3u_id: playlist.m3u_id,
      m3u_name: playlist.m3u_name,
      m3u_url: playlist.m3u_url,
      epg_xml: playlist.epg_xml,
      stream_format: playlist.stream_format,
      m3u_active: playlist.m3u_active,
      m3u_priority: playlist.m3u_priority,
      station_check: playlist.station_check
    })));
    console.log("Hidden input updated:", priorityPlaylistsInput.value); // Debugging
  }

  populateLists();
  playlists_updateHiddenInput();
</script>
<!-- Background Color of Header Labels -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const darkModeToggle = document.getElementById('dark-version');

    // Function to update the background color of the specific grid-container
    function updateGridContainerBackground() {
      const bodyStyle = getComputedStyle(document.body);
      const bodyBgColor = bodyStyle.backgroundColor;

      // Apply the background color to the specific grid-container
      document.querySelectorAll('.dynamic-bg').forEach(container => {
        container.style.backgroundColor = bodyBgColor;
      });
    }

    // Initial update of the grid-container background color
    updateGridContainerBackground();

    // Listen for changes to the dark mode toggle
    if (darkModeToggle) {
      darkModeToggle.addEventListener('change', function () {
        updateGridContainerBackground();
      });
    }
  });
</script>
<!-- Station Mapping Buttons -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const addMappingButton = document.querySelector('button[name="action"][value="child_station_mapping_new"]');
    const saveMappingButton = document.querySelector('button[name="action"][value="child_station_mapping_save"]');

    function isInvalidMapping(suffix) {
      const sourceCompare = document.getElementById('child_station_mapping_source_field_compare_id_' + suffix);
      const targetCompare = document.getElementById('child_station_mapping_target_field_compare_replace_id_' + suffix);
      if (sourceCompare && targetCompare) {
        return (
          sourceCompare.value.endsWith('_not') &&
          targetCompare.value.endsWith('_string')
        );
      }
      return false;
    }

    function checkMappingNewInputs() {
      const name = document.getElementById('child_station_mapping_station_mapping_name_new').value.trim();
      const invalid = isInvalidMapping('new');
      addMappingButton.disabled = !(name && !invalid);
    }

    function checkMappingExistingInputs() {
      let allValid = true;
      let hasRows = false;
      document.querySelectorAll('input[id^="child_station_mapping_station_mapping_name_"]').forEach(input => {
        if (input.id.endsWith('_new')) return;
        hasRows = true;
        const suffix = input.id.split('child_station_mapping_station_mapping_name_')[1];
        const name = input.value.trim();
        const invalid = isInvalidMapping(suffix);
        if (!(name && !invalid)) allValid = false;
      });
      saveMappingButton.disabled = !allValid || !hasRows;
    }

    // Listen for changes on all relevant fields (names and selects)
    document.querySelectorAll('input[id^="child_station_mapping_station_mapping_name_"]').forEach(input => {
      if (input.id.endsWith('_new')) {
        input.addEventListener('input', checkMappingNewInputs);
      } else {
        input.addEventListener('input', checkMappingExistingInputs);
      }
    });

    // Use jQuery for Select2 fields
    if (window.jQuery) {
      $('select[id^="child_station_mapping_source_field_compare_id_"]').on('change.select2', function() {
        if (this.id.endsWith('_new')) {
          checkMappingNewInputs();
        } else {
          checkMappingExistingInputs();
        }
      });
      $('select[id^="child_station_mapping_target_field_compare_replace_id_"]').on('change.select2', function() {
        if (this.id.endsWith('_new')) {
          checkMappingNewInputs();
        } else {
          checkMappingExistingInputs();
        }
      });
    } else {
      // Fallback for non-Select2 (shouldn't be needed, but safe)
      document.querySelectorAll('select[id^="child_station_mapping_source_field_compare_id_"]').forEach(select => {
        if (select.id.endsWith('_new')) {
          select.addEventListener('change', checkMappingNewInputs);
        } else {
          select.addEventListener('change', checkMappingExistingInputs);
        }
      });
      document.querySelectorAll('select[id^="child_station_mapping_target_field_compare_replace_id_"]').forEach(select => {
        if (select.id.endsWith('_new')) {
          select.addEventListener('change', checkMappingNewInputs);
        } else {
          select.addEventListener('change', checkMappingExistingInputs);
        }
      });
    }

    checkMappingNewInputs();
    checkMappingExistingInputs();
  });
</script>
<!-- Station Mapping Priority -->
<script>
  const priorityChildStationMappings = {{ html_station_mappings | tojson }};
  const priorityChildStationMappingsList = document.getElementById('priorityChildStationMappingsList');
  const priorityChildStationMappingsInput = document.getElementById('priority_child_station_mappings');

  function populateChildStationMappingsLists() {
    priorityChildStationMappingsList.innerHTML = '';
    const activeChildStationMappings = priorityChildStationMappings.filter(station_mapping => station_mapping.station_mapping_active === 'On');
    activeChildStationMappings.sort((a, b) => (a.station_mapping_priority || 0) - (b.station_mapping_priority || 0));
    activeChildStationMappings.forEach(station_mapping => {
        const option = document.createElement('option');
        option.value = station_mapping.station_mapping_id;
        option.text = station_mapping.station_mapping_name;
        priorityChildStationMappingsList.appendChild(option);
    });
  }

  function child_station_mappings_moveUp() {
    const selectedChildStationMappingsOptions = Array.from(priorityChildStationMappingsList.selectedOptions);
    selectedChildStationMappingsOptions.forEach(option => {
      const previousChildStationMappingsOption = option.previousElementSibling;
      if (previousChildStationMappingsOption) {
        priorityChildStationMappingsList.insertBefore(option, previousChildStationMappingsOption);
        child_station_mappings_updateChildStationMappingPriority();
      }
    });
  }

  function child_station_mappings_moveDown() {
    const selectedChildStationMappingsOptions = Array.from(priorityChildStationMappingsList.selectedOptions);
    selectedChildStationMappingsOptions.reverse().forEach(option => {
      const nextChildStationMappingsOption = option.nextElementSibling;
      if (nextChildStationMappingsOption) {
        priorityChildStationMappingsList.insertBefore(nextChildStationMappingsOption, option);
        child_station_mappings_updateChildStationMappingPriority();
      }
    });
  }

  function child_station_mappings_updateChildStationMappingPriority() {
    const allChildStationMappingsOptions = Array.from(priorityChildStationMappingsList.options);
    const activeChildStationMappings = priorityChildStationMappings.filter(station_mapping => station_mapping.station_mapping_active === 'On');
    
    // Ensure unique priorities for active station mappings first
    allChildStationMappingsOptions.forEach((option, index) => {
      const station_mapping = activeChildStationMappings.find(s => s.station_mapping_id === option.value);
      if (station_mapping) {
        station_mapping.station_mapping_priority = index + 1;
      }
    });

    // Reorder priorities to ensure uniqueness across all station mappings
    priorityChildStationMappings.sort((a, b) => (a.station_mapping_priority || 0) - (b.station_mapping_priority || 0));
    priorityChildStationMappings.forEach((station_mapping, index) => {
      station_mapping.station_mapping_priority = index + 1;
    });

    child_station_mappings_updateHiddenInput();
  }

  function child_station_mappings_updateHiddenInput() {
    priorityChildStationMappingsInput.value = JSON.stringify(priorityChildStationMappings.map(station_mapping => ({
      station_mapping_id: station_mapping.station_mapping_id,
      station_mapping_name: station_mapping.station_mapping_name,
      station_mapping_active: station_mapping.station_mapping_active,
      station_mapping_priority: station_mapping.station_mapping_priority,
      source_m3u_id: station_mapping.source_m3u_id,
      source_field: station_mapping.source_field,
      source_field_compare_id: station_mapping.source_field_compare_id,
      source_field_string: station_mapping.source_field_string,
      target_field: station_mapping.target_field,
      target_field_compare_replace_id: station_mapping.target_field_compare_replace_id,
      target_field_string: station_mapping.target_field_string,
      target_parent_channel_id: station_mapping.target_parent_channel_id,
      target_stream_format_override: station_mapping.target_stream_format_override
    })));
    console.log("Hidden input updated:", priorityChildStationMappingsInput.value); // Debugging
  }

  populateChildStationMappingsLists();
  child_station_mappings_updateHiddenInput();
</script>
{% endblock javascripts %}
